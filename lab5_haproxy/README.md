# Лабораторная работа №5

## Задача
>1. На серверах web1, web2 установить Nginx.
>2. На серверах haproxy1, haproxy2 установить и настроить  отказоустойчивую связку HAProxy+Keepalived. Настроить VIP с помощью Keepalived в соответствии со схемой
>3. На серверах web1, web2 Nginx должен работать по порту 8080 и отдавать кастомную страницу, зайдя на которую можно понять на каком сервере вы находитесь.
>4. На серверах с HAProxy ПО должно обеспечить балансировку нагрузки серверов web1 и web2 в режиме round-robin. Сделать таймауты ожидания ответа web1 и web2 как можно меньше. Скажем, 1-2 секунды
>5. Установка и настройка всего ПО должна быть обеспечена Ansible-сценарием.
>6. Все файлы по этому заданию выложить в Github и написать ReadMe со скринами работоспособности и инструкцию по запуску вашего Ansible-сценария.


## Как запустить Ansible-сценарий

1. Склонировать репозиторий
``` 
git clone https://github.com/dif-dif/ansible.git 
```
2. Открыть в терминале папку lab5_haproxy
3. Отредактировать в Vagrantfile ip адреса (при необходимости) и путь до вашего публичного ssh ключа
>("/home/sirius/.ssh/id_rsa.pub")
4. Поднять виртуалку
```
vagrant status (убеждаемся что машины существуют, но не запущены)
vagrant up
```
5. Запустить плейбук
```
ansible-playbook nginx.yml
```

### Скриншоты работоспособности балансировки
- Одну виртуалку с haproxy выключаем. Видим, что оба веб-сервера доступны.
![Веб1](https://github.com/dif-dif/ansible/blob/master/pictures/lab5_1.png)
![Веб2](https://github.com/dif-dif/ansible/blob/master/pictures/lab5_2.png)
- Включаем виртуалку из предыдущего шага, и выключаем вторую. Видим, что Virtual IP перебросился на другой сервер haproxy. Оба веб-сервера все еще доступны.
![Веб1](https://github.com/dif-dif/ansible/blob/master/pictures/lab5_3.png)
![Веб2](https://github.com/dif-dif/ansible/blob/master/pictures/lab5_4.png)
